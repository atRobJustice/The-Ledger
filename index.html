<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel='icon' href='./assets/favicon.ico' type='image/x-icon'/ >
		<title>The Ledger</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English:ital@0;1&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/main.css">
        <style>
            .view-hidden { display: none !important; }
            .view-visible { display: block !important; }
            .view-container { min-height: 500px; }
            .navbar .btn.active { background-color: #0d6efd; border-color: #0d6efd; }
            
            /* Loading and error states */
            .loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                color: white;
            }
            
            .error-container {
                background: #f8d7da;
                border: 1px solid #f5c6cb;
                border-radius: 4px;
                padding: 15px;
                margin: 10px 0;
                color: #721c24;
            }
            
            .retry-button {
                background: #dc3545;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 4px;
                cursor: pointer;
                margin-top: 10px;
            }
            
            .retry-button:hover {
                background: #c82333;
            }
        </style>
	</head>
    <body class="p-3 m-0">
        <h1 class="mt-2"><img src="assets/TheLedger.png" alt="The Ledger" class="logo">The Ledger</h1>
        
        <!-- SPA App Container -->
        <div id="app">
            <!-- Loading indicator -->
            <div id="loading-indicator" class="loading-overlay">
                <div class="text-center">
                    <div class="spinner-border text-light" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Initializing The Ledger...</p>
                </div>
            </div>
            
            <!-- Error container -->
            <div id="error-container" class="error-container" style="display: none;">
                <h4>Application Error</h4>
                <p id="error-message">Failed to initialize The Ledger application. Please refresh the page and try again.</p>
                <button id="retry-button" class="retry-button">Retry</button>
            </div>
            
            <!-- Main application views -->
            <div id="dashboard-view" class="view-container view-hidden">
                <!-- Dashboard content will be loaded here -->
            </div>
            
            <div id="character-sheet-view" class="view-container view-hidden">
                <!-- Character sheet content will be loaded here -->
            </div>
            
            <div id="settings-view" class="view-container view-hidden">
                <!-- Settings content will be loaded here -->
            </div>
            
            <div id="help-view" class="view-container view-hidden">
                <!-- Help content will be loaded here -->
            </div>
        </div>

        <!-- Main manager containers -->
        <div class="disciplines-container"></div>
        <div class="merits-container"></div>
        <div class="flaws-container"></div>
        <div class="loresheets-container"></div>
        
        <!-- Hidden containers for managers -->
        <div id="convictions-container" style="display: none;"></div>
        <div id="experience-container" style="display: none;"></div>
        <div id="dice-container" style="display: none;"></div>
        <div id="modal-container" style="display: none;"></div>
        
        <br/><br/><br/><br/>
        
        <!-- Scripts: Vendor Libraries -->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Scripts: Legacy Utilities -->
        <script src="js/accessibility-fix.js"></script>
        <script src="js/sticky-header.js"></script>
        
        <!-- Scripts: Core Architecture (Traditional loading) -->
        <script src="js/core/ScriptManager.js"></script>
        <script src="js/core/BaseComponent.js"></script>
        <script src="js/core/ComponentRegistry.js"></script>
        <script src="js/core/AppRouter.js"></script>
        <script src="js/core/EventBus.js"></script>
        <script src="js/core/CharacterEventSystem.js"></script>
        <script src="js/core/ViewEventSystem.js"></script>
        <script src="js/core/ErrorBoundary.js"></script>
        <script src="js/core/LoadingStateManager.js"></script>
        
        <!-- Scripts: Utilities -->
        <script src="js/utils/DataBindingManager.js"></script>
        <script src="js/utils/EventDebugger.js"></script>
        
        <!-- Scripts: Reference Data (load before managers) -->
        <script src="js/references/attributes.js"></script>
        <script src="js/references/skills.js"></script>
        <script src="js/references/backgrounds.js"></script>
        <script src="js/references/backgrounds-coterie.js"></script>
        <script src="js/references/merits.js"></script>
        <script src="js/references/loresheets.js"></script>
        <script src="js/references/blood_potency.js"></script>
        <script src="js/references/generation.js"></script>
        <script src="js/references/humanity.js"></script>
        <script src="js/references/predator_types.js"></script>
        <script src="js/references/resonances.js"></script>
        <script src="js/references/compulsions.js"></script>
        <script src="js/references/coterie_types.js"></script>
        <script src="js/references/factions/anarch.js"></script>
        <script src="js/references/factions/camarilla.js"></script>
        <script src="js/references/factions/sabbat.js"></script>
        <script src="js/references/clans/banu_haqim.js"></script>
        <script src="js/references/clans/brujah.js"></script>
        <script src="js/references/clans/caitiff.js"></script>
        <script src="js/references/clans/gangrel.js"></script>
        <script src="js/references/clans/hecata.js"></script>
        <script src="js/references/clans/lasombra.js"></script>
        <script src="js/references/clans/malkavian.js"></script>
        <script src="js/references/clans/ministry.js"></script>
        <script src="js/references/clans/nosferatu.js"></script>
        <script src="js/references/clans/ravnos.js"></script>
        <script src="js/references/clans/salubri.js"></script>
        <script src="js/references/clans/thinblood.js"></script>
        <script src="js/references/clans/toreador.js"></script>
        <script src="js/references/clans/tremere.js"></script>
        <script src="js/references/clans/tzimisce.js"></script>
        <script src="js/references/clans/ventrue.js"></script>
        <script src="js/references/clans.js"></script>
        <script src="js/references/disciplines/animalism.js"></script>
        <script src="js/references/disciplines/auspex.js"></script>
        <script src="js/references/disciplines/blood_sorcery.js"></script>
        <script src="js/references/disciplines/celerity.js"></script>
        <script src="js/references/disciplines/dominate.js"></script>
        <script src="js/references/disciplines/fortitude.js"></script>
        <script src="js/references/disciplines/obfuscate.js"></script>
        <script src="js/references/disciplines/oblivion.js"></script>
        <script src="js/references/disciplines/potence.js"></script>
        <script src="js/references/disciplines/presence.js"></script>
        <script src="js/references/disciplines/protean.js"></script>
        <script src="js/references/disciplines/thin_blood_alchemy.js"></script>
        <script src="js/references/disciplines/blood_sorcery_rituals.js"></script>
        <script src="js/references/disciplines/oblivion_ceremonies.js"></script>
        <script src="js/references/disciplines.js"></script>
        <script src="js/manager-utils.js"></script>
        
        <!-- Scripts: Managers & Utilities -->
        <script src="js/database-manager.js"></script>
        <script src="js/character-manager.js"></script>
        <script src="js/xp-manager.js"></script>
        <script src="js/xp-pricing.js"></script>
        <script src="js/xp-spend-manager.js"></script>
        <script src="js/character-sheet.js"></script>
        <script src="js/discipline-manager.js"></script>
        <script src="js/merit-flaw-manager.js"></script>
        <script src="js/background-manager.js"></script>
        <script src="js/coterie-manager.js"></script>
        <script src="js/loresheet-manager.js"></script>
        <script src="js/discord-integration.js"></script>
        <script src="js/lock-manager.js"></script>
        <script src="js/control-bar.js"></script>
        <script src="js/dice-overlay.js"></script>
        <script src="js/backup-manager.js"></script>
        <script src="js/specialty-manager.js"></script>
        <script src="js/info-buttons.js"></script>
        <script src="js/conviction-manager.js"></script>
        
        <!-- Scripts: Components -->
        <script src="js/components/dashboard/DashboardView.js"></script>
        <script src="js/components/dashboard/CharacterListPanel.js"></script>
        <script src="js/components/dashboard/NavigationPanel.js"></script>
        <script src="js/components/dashboard/QuickActionsPanel.js"></script>
        <script src="js/components/character-sheet/CharacterSheetView.js"></script>
        <script src="js/components/character-sheet/InformationPanel.js"></script>
        <script src="js/components/character-sheet/AttributesPanel.js"></script>
        <script src="js/components/character-sheet/SkillsPanel.js"></script>
        <script src="js/components/character-sheet/VitalsPanel.js"></script>
        <script src="js/components/character-sheet/DisciplinesPanel.js"></script>
        <script src="js/components/character-sheet/MeritsFlawsPanel.js"></script>
        <script src="js/components/character-sheet/BackgroundsPanel.js"></script>
        <script src="js/components/character-sheet/LoresheetsPanel.js"></script>
        <script src="js/components/character-sheet/ConvictionsPanel.js"></script>
        <script src="js/components/character-sheet/ExperiencePanel.js"></script>
        <script src="js/components/shared/ModalComponent.js"></script>
        <script src="js/components/shared/ButtonComponent.js"></script>
        <script src="js/components/shared/DropdownComponent.js"></script>
        <script src="js/components/shared/TrackBoxComponent.js"></script>
        <script src="js/components/shared/DotTrackComponent.js"></script>
        
        <!-- Scripts: Testing Framework -->
        <script src="js/testing/TestFramework.js"></script>
        <script src="js/testing/ComponentTestUtils.js"></script>
        
        <!-- Scripts: Main Application -->
        <script src="js/app.js"></script>
        
        <script>
            // Global error handler
            window.addEventListener('error', function(event) {
                console.error('Global error:', event.error);
                const errorContainer = document.getElementById('error-container');
                const errorMessage = document.getElementById('error-message');
                const loadingIndicator = document.getElementById('loading-indicator');
                
                if (errorContainer && errorMessage) {
                    errorMessage.textContent = event.error.message || 'An unexpected error occurred';
                    errorContainer.style.display = 'block';
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                }
            });
            
            // Retry functionality
            document.addEventListener('DOMContentLoaded', function() {
                const retryButton = document.getElementById('retry-button');
                if (retryButton) {
                    retryButton.addEventListener('click', function() {
                        window.location.reload();
                    });
                }
            });
            
            const textPrimary = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
        </script>
    </body>
</html>